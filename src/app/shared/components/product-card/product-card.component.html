<div class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-300">
  <!-- Product Image -->
  <figure class="relative">
    <a [routerLink]="['/products', product.slug]" class="block w-full">
      <img
        [src]="productImage"
        [alt]="product.name"
        class="w-full h-64 object-cover"
        loading="lazy"
      />
    </a>

    <!-- Discount Badge -->
    @if (hasDiscount) {
      <div class="badge badge-secondary absolute top-2 right-2 gap-1">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6z" />
        </svg>
        -{{ discountPercentage }}%
      </div>
    }

    <!-- Out of Stock Badge -->
    @if (!isInStock) {
      <div class="badge badge-error absolute top-2 left-2">
        Agotado
      </div>
    }

    <!-- Featured Badge -->
    @if (product.featured) {
      <div class="badge badge-primary absolute top-2 left-2">
        Destacado
      </div>
    }
  </figure>

  <!-- Product Info -->
  <div class="card-body p-4">
    <!-- Product Name -->
    <h2 class="card-title text-base">
      <a [routerLink]="['/products', product.slug]" class="hover:text-primary transition-colors line-clamp-2">
        {{ product.name }}
      </a>
    </h2>

    <!-- Product Category -->
    @if (product.categories && product.categories.length > 0) {
      <div class="text-xs text-base-content/60 mb-2">
        {{ product.categories[0].name }}
      </div>
    }

    <!-- Product Rating -->
    @if (product.ratingCount > 0) {
      <div class="flex items-center gap-1 mb-2">
        <div class="rating rating-sm">
          @for (star of [1,2,3,4,5]; track star) {
            <input
              type="radio"
              class="mask mask-star-2 bg-orange-400"
              [checked]="star <= Math.round(product.averageRating)"
              disabled
            />
          }
        </div>
        <span class="text-xs text-base-content/60">({{ product.ratingCount }})</span>
      </div>
    }

    <!-- Product Price -->
    <div class="flex items-center gap-2 mb-4">
      @if (hasDiscount) {
        <span class="text-xl font-bold text-primary">
          ${{ product.salePrice.toFixed(2) }}
        </span>
        <span class="text-sm text-base-content/60 line-through">
          ${{ product.regularPrice.toFixed(2) }}
        </span>
      } @else {
        <span class="text-xl font-bold text-primary">
          ${{ product.price.toFixed(2) }}
        </span>
      }
    </div>

    <!-- Action Buttons -->
    <div class="card-actions justify-between items-center">
      <!-- View Details Link -->
      <a
        [routerLink]="['/products', product.slug]"
        class="btn btn-ghost btn-sm"
      >
        Ver Detalles
      </a>

      <!-- Add to Cart Button -->
      @if (isPurchasable) {
        <button
          (click)="addToCart()"
          [disabled]="isAddingToCart()"
          class="btn btn-primary btn-sm"
        >
          @if (isAddingToCart()) {
            <span class="loading loading-spinner loading-xs"></span>
            Agregando...
          } @else {
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 00-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 00-16.536-1.84M7.5 14.25L5.106 5.272M6 20.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm12.75 0a.75.75 0 11-1.5 0 .75.75 0 011.5 0z" />
            </svg>
            Agregar
          }
        </button>
      } @else {
        <button class="btn btn-disabled btn-sm">
          No Disponible
        </button>
      }
    </div>
  </div>
</div>
