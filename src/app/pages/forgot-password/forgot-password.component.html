<div class="min-h-screen flex items-center justify-center bg-base-200 py-12 px-4 sm:px-6 lg:px-8">
  <div class="max-w-md w-full">
    <!-- Card Container -->
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <!-- Header -->
        <div class="text-center mb-6">
          <h1 class="text-3xl font-bold text-base-content">Reset Password</h1>
          <p class="text-base-content/70 mt-2">
            @switch (currentStep()) {
              @case (1) {
                Enter your email to receive a reset code
              }
              @case (2) {
                Enter the code sent to your email
              }
              @case (3) {
                Create your new password
              }
            }
          </p>
        </div>

        <!-- Progress Steps -->
        <div class="mb-6">
          <ul class="steps steps-horizontal w-full">
            <li class="step" [class.step-primary]="currentStep() >= 1">Email</li>
            <li class="step" [class.step-primary]="currentStep() >= 2">Code</li>
            <li class="step" [class.step-primary]="currentStep() >= 3">Password</li>
          </ul>
        </div>

        <!-- Step 1: Email Form -->
        @if (currentStep() === 1) {
          <form [formGroup]="emailForm" (ngSubmit)="onSubmitEmail()" class="space-y-4">
            <!-- Email Field -->
            <div class="form-control w-full">
              <label class="label" for="email">
                <span class="label-text font-medium">Email Address</span>
              </label>
              <input
                type="email"
                id="email"
                formControlName="email"
                placeholder="your@email.com"
                class="input input-bordered w-full"
                [class.input-error]="hasFieldError(emailForm, 'email')"
                [disabled]="isLoading()"
                autofocus
              />
              @if (hasFieldError(emailForm, 'email')) {
                <label class="label">
                  <span class="label-text-alt text-error">{{ getFieldError(emailForm, 'email') }}</span>
                </label>
              }
            </div>

            <!-- Info Alert -->
            <div class="alert alert-info">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <span class="text-sm">We'll send a verification code to your email if it exists in our system.</span>
            </div>

            <!-- Submit Button -->
            <div class="form-control mt-6">
              <button
                type="submit"
                class="btn btn-primary w-full"
                [disabled]="isLoading()"
              >
                @if (isLoading()) {
                  <span class="loading loading-spinner loading-sm"></span>
                  Sending code...
                } @else {
                  Send Reset Code
                }
              </button>
            </div>
          </form>
        }

        <!-- Step 2: Code Form -->
        @if (currentStep() === 2) {
          <form [formGroup]="codeForm" (ngSubmit)="onSubmitCode()" class="space-y-4">
            <!-- Email Display -->
            <div class="alert">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-info shrink-0 w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <span class="text-sm">Code sent to: <strong>{{ userEmail() }}</strong></span>
            </div>

            <!-- Code Field -->
            <div class="form-control w-full">
              <label class="label" for="code">
                <span class="label-text font-medium">Verification Code</span>
              </label>
              <input
                type="text"
                id="code"
                formControlName="code"
                placeholder="Enter code"
                class="input input-bordered w-full text-center text-lg tracking-widest"
                [class.input-error]="hasFieldError(codeForm, 'code')"
                [disabled]="isLoading()"
                autofocus
              />
              @if (hasFieldError(codeForm, 'code')) {
                <label class="label">
                  <span class="label-text-alt text-error">{{ getFieldError(codeForm, 'code') }}</span>
                </label>
              }
            </div>

            <!-- Info Alert -->
            <div class="alert alert-warning">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
              </svg>
              <span class="text-sm">Check your email inbox and spam folder for the code.</span>
            </div>

            <!-- Buttons -->
            <div class="form-control mt-6 space-y-3">
              <button
                type="submit"
                class="btn btn-primary w-full"
                [disabled]="isLoading()"
              >
                @if (isLoading()) {
                  <span class="loading loading-spinner loading-sm"></span>
                  Verifying...
                } @else {
                  Verify Code
                }
              </button>

              <button
                type="button"
                (click)="goToPreviousStep()"
                class="btn btn-ghost w-full"
                [disabled]="isLoading()"
              >
                &larr; Back to Email
              </button>
            </div>
          </form>
        }

        <!-- Step 3: Password Form -->
        @if (currentStep() === 3) {
          <form [formGroup]="passwordForm" (ngSubmit)="onSubmitPassword()" class="space-y-4">
            <!-- Success Alert -->
            <div class="alert alert-success">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <span class="text-sm">Code verified! Now create your new password.</span>
            </div>

            <!-- Password Field -->
            <div class="form-control w-full">
              <label class="label" for="password">
                <span class="label-text font-medium">New Password</span>
              </label>
              <div class="relative">
                <input
                  [type]="showPassword() ? 'text' : 'password'"
                  id="password"
                  formControlName="password"
                  placeholder="Create a strong password"
                  class="input input-bordered w-full pr-10"
                  [class.input-error]="hasFieldError(passwordForm, 'password')"
                  [disabled]="isLoading()"
                  autofocus
                />
                <button
                  type="button"
                  (click)="togglePasswordVisibility()"
                  class="absolute right-3 top-1/2 -translate-y-1/2 text-base-content/50 hover:text-base-content"
                  [disabled]="isLoading()"
                  tabindex="-1"
                >
                  @if (showPassword()) {
                    <!-- Eye Slash Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.242 4.242L9.88 9.88" />
                    </svg>
                  } @else {
                    <!-- Eye Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
                      <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                  }
                </button>
              </div>

              <!-- Password Strength Indicator -->
              @if (passwordForm.get('password')?.value && passwordForm.get('password')?.touched) {
                <div class="mt-2">
                  @switch (getPasswordStrength()) {
                    @case ('weak') {
                      <div class="flex items-center gap-2">
                        <progress class="progress progress-error w-full" value="33" max="100"></progress>
                        <span class="text-xs text-error">Weak</span>
                      </div>
                    }
                    @case ('medium') {
                      <div class="flex items-center gap-2">
                        <progress class="progress progress-warning w-full" value="66" max="100"></progress>
                        <span class="text-xs text-warning">Medium</span>
                      </div>
                    }
                    @case ('strong') {
                      <div class="flex items-center gap-2">
                        <progress class="progress progress-success w-full" value="100" max="100"></progress>
                        <span class="text-xs text-success">Strong</span>
                      </div>
                    }
                  }
                </div>
              }

              @if (hasFieldError(passwordForm, 'password')) {
                <label class="label">
                  <span class="label-text-alt text-error">{{ getFieldError(passwordForm, 'password') }}</span>
                </label>
              }
            </div>

            <!-- Confirm Password Field -->
            <div class="form-control w-full">
              <label class="label" for="confirmPassword">
                <span class="label-text font-medium">Confirm New Password</span>
              </label>
              <div class="relative">
                <input
                  [type]="showConfirmPassword() ? 'text' : 'password'"
                  id="confirmPassword"
                  formControlName="confirmPassword"
                  placeholder="Re-enter your password"
                  class="input input-bordered w-full pr-10"
                  [class.input-error]="hasFieldError(passwordForm, 'confirmPassword')"
                  [disabled]="isLoading()"
                />
                <button
                  type="button"
                  (click)="toggleConfirmPasswordVisibility()"
                  class="absolute right-3 top-1/2 -translate-y-1/2 text-base-content/50 hover:text-base-content"
                  [disabled]="isLoading()"
                  tabindex="-1"
                >
                  @if (showConfirmPassword()) {
                    <!-- Eye Slash Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.242 4.242L9.88 9.88" />
                    </svg>
                  } @else {
                    <!-- Eye Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
                      <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                  }
                </button>
              </div>
              @if (hasFieldError(passwordForm, 'confirmPassword')) {
                <label class="label">
                  <span class="label-text-alt text-error">{{ getFieldError(passwordForm, 'confirmPassword') }}</span>
                </label>
              }
            </div>

            <!-- Buttons -->
            <div class="form-control mt-6 space-y-3">
              <button
                type="submit"
                class="btn btn-primary w-full"
                [disabled]="isLoading()"
              >
                @if (isLoading()) {
                  <span class="loading loading-spinner loading-sm"></span>
                  Resetting password...
                } @else {
                  Reset Password
                }
              </button>

              <button
                type="button"
                (click)="goToPreviousStep()"
                class="btn btn-ghost w-full"
                [disabled]="isLoading()"
              >
                &larr; Back to Code
              </button>
            </div>
          </form>
        }

        <!-- Divider -->
        <div class="divider">OR</div>

        <!-- Login Link -->
        <div class="text-center">
          <p class="text-base-content/70">
            Remember your password?
            <a
              routerLink="/login"
              class="link link-primary font-medium"
              [class.pointer-events-none]="isLoading()"
            >
              Sign in
            </a>
          </p>
        </div>
      </div>
    </div>

    <!-- Back to Home Link -->
    <div class="text-center mt-4">
      <a
        routerLink="/home"
        class="link link-neutral text-sm"
        [class.pointer-events-none]="isLoading()"
      >
        &larr; Back to Home
      </a>
    </div>
  </div>
</div>
