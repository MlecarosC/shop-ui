<div class="min-h-screen bg-base-100">
  <!-- Loading State -->
  @if (isLoading()) {
    <div class="container mx-auto px-4 py-16">
      <div class="max-w-4xl mx-auto">
        <div class="animate-pulse space-y-8">
          <!-- Header Skeleton -->
          <div class="text-center">
            <div class="w-20 h-20 rounded-full bg-base-300 mx-auto mb-4"></div>
            <div class="h-8 bg-base-300 rounded w-64 mx-auto mb-2"></div>
            <div class="h-4 bg-base-300 rounded w-48 mx-auto"></div>
          </div>

          <!-- Card Skeleton -->
          <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
              <div class="space-y-4">
                <div class="h-6 bg-base-300 rounded w-3/4"></div>
                <div class="h-4 bg-base-300 rounded w-1/2"></div>
                <div class="h-4 bg-base-300 rounded w-2/3"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  }

  <!-- Error State -->
  @else if (hasError()) {
    <div class="container mx-auto px-4 py-16">
      <div class="max-w-md mx-auto text-center">
        <!-- Error Icon -->
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-24 h-24 mx-auto text-error mb-4">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />
        </svg>

        <h2 class="text-2xl font-bold text-base-content mb-2">
          Orden no encontrada
        </h2>
        <p class="text-base-content/60 mb-6">
          No pudimos encontrar la orden solicitada. Por favor verifica el número de orden o intenta nuevamente.
        </p>

        <div class="flex flex-col sm:flex-row gap-3 justify-center">
          <button (click)="goToHome()" class="btn btn-primary">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
            </svg>
            Volver al Inicio
          </button>
          <button (click)="retryLoad()" class="btn btn-outline">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
            </svg>
            Reintentar
          </button>
        </div>
      </div>
    </div>
  }

  <!-- Order Confirmation Content -->
  @else if (order()) {
    <div class="container mx-auto px-4 py-8 sm:py-12">
      <div class="max-w-4xl mx-auto">
        <!-- Success Header -->
        <div class="text-center mb-8">
          <!-- Success Icon with Animation -->
          <div class="relative inline-block mb-4">
            <div class="w-20 h-20 rounded-full bg-success/10 flex items-center justify-center animate-pulse">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-10 h-10 text-success">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
          </div>

          <h1 class="text-3xl sm:text-4xl font-bold text-base-content mb-2">
            ¡Pedido Confirmado!
          </h1>
          <p class="text-lg text-base-content/70">
            Gracias por tu compra. Tu pedido ha sido recibido.
          </p>
        </div>

        <!-- Order Summary Card -->
        <div class="card bg-base-100 shadow-xl border border-base-300 mb-6">
          <div class="card-body p-6 sm:p-8">
            <!-- Order Info -->
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 pb-6 border-b border-base-300">
              <div>
                <p class="text-sm text-base-content/60 mb-1">Número de Orden</p>
                <p class="font-semibold text-base-content text-lg">#{{ getOrderNumber() }}</p>
              </div>
              <div>
                <p class="text-sm text-base-content/60 mb-1">Fecha</p>
                <p class="font-semibold text-base-content">{{ getFormattedDate() }}</p>
              </div>
              <div>
                <p class="text-sm text-base-content/60 mb-1">Estado</p>
                <span class="badge badge-lg" [ngClass]="getStatusBadgeClass()">
                  {{ getStatusLabel() }}
                </span>
              </div>
            </div>

            <!-- Order Items -->
            <div class="py-6 border-b border-base-300">
              <h3 class="text-xl font-bold text-base-content mb-4">Productos</h3>
              <div class="space-y-4">
                @for (item of order()!.line_items; track item.id) {
                  <div class="flex gap-4">
                    <!-- Product Image -->
                    <div class="w-20 h-20 rounded-lg overflow-hidden bg-base-200 shrink-0">
                      <img
                        [src]="getItemImage(item)"
                        [alt]="item.name"
                        class="w-full h-full object-cover"
                        loading="lazy"
                      />
                    </div>

                    <!-- Product Details -->
                    <div class="flex-1 min-w-0">
                      <h4 class="font-semibold text-base-content mb-1">{{ item.name }}</h4>
                      @if (item.parent_name) {
                        <p class="text-sm text-base-content/60 mb-1">{{ item.parent_name }}</p>
                      }
                      <p class="text-sm text-base-content/60">
                        Cantidad: {{ item.quantity }}
                      </p>
                    </div>

                    <!-- Price -->
                    <div class="text-right shrink-0">
                      <p class="font-semibold text-base-content">
                        ${{ formatPrice(item.total) }}
                      </p>
                      @if (item.subtotal !== item.total) {
                        <p class="text-sm text-base-content/60 line-through">
                          ${{ formatPrice(item.subtotal) }}
                        </p>
                      }
                    </div>
                  </div>
                }
              </div>
            </div>

            <!-- Order Totals -->
            <div class="py-6 border-b border-base-300">
              <h3 class="text-xl font-bold text-base-content mb-4">Resumen</h3>
              <div class="space-y-2">
                <div class="flex justify-between">
                  <span class="text-base-content/70">Subtotal:</span>
                  <span class="text-base-content">${{ formatPrice(order()!.total) }}</span>
                </div>
                @if (parseFloat(order()!.shipping_total) > 0) {
                  <div class="flex justify-between">
                    <span class="text-base-content/70">Envío:</span>
                    <span class="text-base-content">${{ formatPrice(order()!.shipping_total) }}</span>
                  </div>
                }
                @if (parseFloat(order()!.total_tax) > 0) {
                  <div class="flex justify-between">
                    <span class="text-base-content/70">Impuestos:</span>
                    <span class="text-base-content">${{ formatPrice(order()!.total_tax) }}</span>
                  </div>
                }
                @if (parseFloat(order()!.discount_total) > 0) {
                  <div class="flex justify-between text-success">
                    <span>Descuento:</span>
                    <span>-${{ formatPrice(order()!.discount_total) }}</span>
                  </div>
                }
                <div class="divider my-2"></div>
                <div class="flex justify-between text-lg font-bold">
                  <span class="text-base-content">Total:</span>
                  <span class="text-primary">${{ formatPrice(order()!.total) }}</span>
                </div>
              </div>
            </div>

            <!-- Addresses -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 py-6 border-b border-base-300">
              <!-- Billing Address -->
              <div>
                <h4 class="font-semibold text-base-content mb-3 flex items-center gap-2">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-primary">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5z" />
                  </svg>
                  Dirección de Facturación
                </h4>
                <div class="text-sm text-base-content/70 space-y-1">
                  <p class="font-medium text-base-content">
                    {{ order()!.billing.first_name }} {{ order()!.billing.last_name }}
                  </p>
                  <p>{{ getFullBillingAddress() }}</p>
                  @if (order()!.billing.email) {
                    <p>{{ order()!.billing.email }}</p>
                  }
                  @if (order()!.billing.phone) {
                    <p>{{ order()!.billing.phone }}</p>
                  }
                </div>
              </div>

              <!-- Shipping Address -->
              <div>
                <h4 class="font-semibold text-base-content mb-3 flex items-center gap-2">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-primary">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 18.75a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h6m-9 0H3.375a1.125 1.125 0 01-1.125-1.125V14.25m17.25 4.5a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h1.125c.621 0 1.125-.504 1.125-1.125V11.25m-17.25 0h16.5M3.75 11.25V8.625c0-.621.504-1.125 1.125-1.125h4.916c.29 0 .562.131.742.356l1.67 2.09a1.5 1.5 0 001.116.499h6.431c.621 0 1.125.504 1.125 1.125v2.625m-17.25 0V18a1.125 1.125 0 001.125 1.125h13.5A1.125 1.125 0 0021.75 18v-6.75" />
                  </svg>
                  Dirección de Envío
                </h4>
                <div class="text-sm text-base-content/70 space-y-1">
                  <p class="font-medium text-base-content">
                    {{ order()!.shipping.first_name }} {{ order()!.shipping.last_name }}
                  </p>
                  <p>{{ getFullShippingAddress() }}</p>
                </div>
              </div>
            </div>

            <!-- Payment Method -->
            <div class="py-6">
              <h4 class="font-semibold text-base-content mb-3 flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-primary">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5z" />
                </svg>
                Método de Pago
              </h4>
              <p class="text-base-content/70">{{ order()!.payment_method_title }}</p>
            </div>
          </div>
        </div>

        <!-- Next Steps -->
        <div class="alert alert-info mb-6">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <div>
            <h3 class="font-bold">Próximos Pasos</h3>
            <div class="text-sm">
              <p>Recibirás un correo de confirmación con los detalles de tu pedido.</p>
              <p>Puedes hacer seguimiento de tu pedido en la sección "Mis Órdenes".</p>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          @if (isAuthenticated()) {
            <button (click)="goToOrders()" class="btn btn-primary btn-lg">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z" />
              </svg>
              Ver Mis Órdenes
            </button>
          }
          <button (click)="continueShopping()" class="btn btn-outline btn-lg">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119 1.007zM8.625 10.5a.375.375 0 11-.75 0 .375.375 0 01.75 0zm7.5 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
            </svg>
            Seguir Comprando
          </button>
        </div>
      </div>
    </div>
  }
</div>
